{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'pagestyle.css' %}">
    <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">


<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Energy Monitoring and Management System</title>
  </head>
  <body>
    <div class="mainclass">
      <aside class="sidebar">
        <nav class="navbar">
          <span class="container-fluid">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <img class="navbar-brand" src="{% static 'assets/logo.png' %}" alt="LOGO">
                </a>
              </li>
              <li class="nav-item card userCard">
                <a class="nav-link" href="#">
                  <img class="card-img-top" src="{% static 'assets/user.jpg' %}" alt="USER">
                  <div class="card-body">
                    <h4 class="card-title">{{fname}} {{lname}}</h4>
                  </div>
                </a>
              </li>
              <li class="nav-item menu">
                <a class="nav-link" href="{% url 'home' %}"><i class="bi bi-house-door"></i>Dashboard</a>
              </li>
              <li class="nav-item menu">
                <a class="nav-link" href="{% url 'cost' %}"><i class="bi bi-currency-dollar"></i>Cost</a>
              </li>
              <li class="nav-item menu">
                <a class="nav-link" href="{% url 'app' %}"><i class="bi bi-lightbulb"></i>Appliances</a>
              </li>
              <li class="nav-item menu">
                <a class="nav-link" href="{% url 'room' %}"><i class="bi bi-door-open"></i>Usage by Rooms</a>
              </li>
              <li class="nav-item sys_menu">
                <a class="nav-link" href="{% url 'about' %}"><i class="bi bi-info-lg"></i>About Us</a>
              </li>
              <li class="nav-item sys_menu">
                <a class="nav-link" href="{% url 'contact' %}"><i class="bi bi-telephone"></i>Contact Us</a>
              </li>
            </ul>
          </span>
        </nav>
      </aside>
      <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAbmZPy5lUsA0mo_0tbkSH2DemypRRgyb4",
          authDomain: "powersmart-f14f1.firebaseapp.com",
          databaseURL: "https://powersmart-f14f1-default-rtdb.firebaseio.com",
          projectId: "powersmart-f14f1",
          storageBucket: "powersmart-f14f1.appspot.com",
          messagingSenderId: "514395710434",
          appId: "1:514395710434:web:08995e3ea6bf699cda0fbb",
          measurementId: "G-8916GFC3LH"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
    
        // Access the Firebase Realtime Database and retrieve data
        const dataRef = ref(database, "/sensorData");
        onValue(dataRef, (snapshot) => {
          const data = snapshot.val();
    
          // Update the values on the web page
          document.getElementById('kettle-power').textContent = data.power || 'Data not available';
        });
      </script>
    <div class="maincon">
    <div class="card">
      <div class="card-body">
        <div class="container mb-5 mt-3">
          <div class="row d-flex align-items-baseline">
            <div class="col-xl-9">
              <p style="color: #7e8d9f;font-size: 20px;">Monthly Bill: </p>
            </div>
            
            <hr>
          </div>
    
          <div class="container">
            <div class="col-md-12">
              <div class="text-center">
                <i class="fab fa-mdb fa-4x ms-0" style="color:#5d9fc5 ;"></i>
                
              </div>
    
            </div>
    
    
            <div class="row">
              <div class="col-xl-8">
                <ul class="list-unstyled">
                  <li class="text-muted">To: <span style="color:#5d9fc5 ;">{{fname}} {{lname}}</span></li>
                </ul>
              </div>
              <div class="col-xl-4">
                <p class="text-muted">Invoice</p>
                <ul class="list-unstyled">
                  <li class="text-muted"><i class="fas fa-circle" style="color:#84B0CA ;"></i> <span
                      class="fw-bold">ID:</span>#123-456</li>
                      <li class="text-muted">
                        <i class="fas fa-circle" style="color:#84B0CA ;"></i>
                        <span class="fw-bold creation-date">Creation Date: </span>
                      </li>
                      
                  <li class="text-muted"><i class="fas fa-circle" style="color:#84B0CA ;"></i> <span
                      class="me-1 fw-bold">Status:</span><span class="badge bg-warning text-black fw-bold">
                      Unpaid</span></li>
                </ul>
              </div>
            </div>

            <!-- Move the <script> tag after the "creation-date" list item -->

<script>
  // Get the current date
  const currentDate = new Date();
            
  // Format the date as "MMM DD, YYYY" (e.g., Jun 23, 2023)
  const formattedDate = currentDate.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric"
  });
            
  // Update the content of the span with the formatted date
  document.querySelector(".creation-date").textContent += formattedDate;
</script>

    
            <div class="row my-2 mx-1 justify-content-center">
              <table class="table table-striped table-borderless">
                <thead style="background-color:#84B0CA ;" class="text-white">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Appliance Name</th>
                    <th scope="col">Current Units</th>
                    <th scope="col">Cost per unit(Rs)</th>
                    <th scope="col">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Kettle</td>
                    <td>4</td>
                    <td>2.0</td>
                    <td id="amount1"></td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Fridge</td>
                    <td>0.001</td>
                    <td>2.0</td>
                    <td id="amount2"></td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Microwave</td>
                    <td>0.001</td>
                    <td>2.0</td>
                    <td id="amount3"></td>
                  </tr>
                </tbody>
    
              </table>
              
            </div>
            <div class="row">
              <div class="col-xl-9">
                <p class="ms-3"></p>
    
              </div>
              <div class="col-xl-3">
                <p>Subtotal: <span id="subtotal">0</span></p>
                <p>Tax (15%): <span id="tax">0</span></p>
                <p>Grand Total: <span id="grandTotal">0</span></p>
                <!--<ul class="list-unstyled">
                  <li class="ms-3"><p>Subtotal: <span id="subtotal">0</span></p></li>
                  <li class="ms-3 mt-2"><span class="text-black me-4">Tax(15%)</span>$111</li>
                </ul>
                <p class="text-black float-start"><span class="text-black me-3"> Total Amount</span><span
                    style="font-size: 25px;">$1221</span></p>-->
              </div>
            </div>
                        <hr>
            <div class="row">
              <div class="col-xl-10">
                <p>Thank you</p>
              </div>
            </div>
    
          </div>
        </div>
      </div>
    </div>
  </div>
    
  </div>
  
  <script>
    function calculateAmount(currentUnits, costPerUnit) {
      // Multiply currentUnits by 1000 to convert to whole number
      const currentUnitsWhole = currentUnits * 1000;
      return (currentUnitsWhole * costPerUnit) / 1000; // Divide by 1000 to get the actual amount
    }
  
    function calculateSubtotal() {
      const amounts = document.querySelectorAll('[id^="amount"]');
      let subtotal = 0;
      amounts.forEach((amount) => {
        subtotal += parseFloat(amount.textContent || 0);
      });
      return subtotal;
    }
  
    function calculateGrandTotal(subtotal) {
      const taxPercentage = 15;
      const taxAmount = (subtotal * taxPercentage) / 100;
      return subtotal + taxAmount;
    }
  
    function updateTable() {
      const currentUnits = [4, 0.001, 0.001]; // Update the values here (e.g., [4, 2, 1])
      const costPerUnit = [2.0, 2.0, 2.0]; // Update the actual cost per unit here
      for (let i = 1; i <= 3; i++) {
        const amount = calculateAmount(currentUnits[i - 1], costPerUnit[i - 1]);
        document.getElementById(`amount${i}`).textContent = `Rs ${amount.toFixed(2)}`;
      }
  
      const subtotal = calculateSubtotal();
      document.getElementById('subtotal').textContent = `Rs ${subtotal.toFixed(2)}`;
  
      const grandTotal = calculateGrandTotal(subtotal);
      document.getElementById('grandTotal').textContent = `Rs ${grandTotal.toFixed(2)}`;
    }
  
    updateTable();
  </script>
  

  
</body>
</html>